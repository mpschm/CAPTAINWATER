<div class="container" id="waitingroom2">

  <div>
    <h3 id="title", style='position: fixed; top: 30px; margin: auto; color: #00bcc2; font-family: Roboto, sans-serif; text-align: center'>Score...</h3>

    <div class="bubble1">
      <div>
        <h1>Winner!</h1>
        <h2><%= @plays.first.user.email %></h2>
        <h1><%= @plays.first.score %> points</h1>
      </div>
    </div>

<!-- user_id: current_user.id
 -->

    <div class="bubble2">
      <div>
        <h1><%= @plays.second.user.email %>
        </br>
        <%= @plays.second.score %></h1>
      </div>
    </div>

    <div class="bubble3"
    style="background-image: url(<%= image_path 'drop-b-happy.png' %>)">
    </div>

    <div class="bubble4"
    style="background-image: url(<%= image_path 'drop-b-sad.png' %>)">
    </div>

    <div class="bubble5"
    style="background-image: url(<%= image_path 'drop-b-sad.png' %>)">
    </div>

    <div class="bubble6"
    style="background-image: url(<%= image_path 'drop-b-sad.png' %>)">
    </div>
  </div>

  <div style='position: relative;'>
    <h5>list of players:</h5>
    <ul style='position: relative'>

      <% @game.plays.each do |play| %>
        <% if play.user_answers.size == 10 %>
          <div class="list-scores d-flex">
            <li><%= play.user.email %></li>
            <%= play.score %>
          </div>
        <% end  %>
      <% end  %>
    </ul>
  </div>

  <% if current_user.admin? %>
    <%= link_to 'Stop the game', stop_game_path(@game), class: "btn-launch" %>
  <% end %>

</div>

<%= render 'plays/ranking' %>

<% content_for :after_js do %>
  <script>
    App['game_<%= @game.id %>'] = App.cable.subscriptions.create(
      { channel: 'PlayChannel', game_id: <%= @game.id %> },
       {
        received: (data) => {
          console.log(data);
          if (data.game_finished === true) {
            let waitingRoom2 = document.getElementById('waitingroom2');
            waitingRoom2.classList.add('d-none');
            let ranking = document.getElementById('players-ranking');
            ranking.classList.remove('d-none');
          }
          if (data.new_finisher && date.new_score) {
            let scores = document.querySelector(".list-scores");
            scores.insertAdjacentHTML("beforeend", "<li>" + data.new_finisher + "</li>" + "<p>" + data.new_score + "</p>");
          }
        }
      }
    )
  </script>
<% end %>
